# 生日主题 – 礼物模式设计

本文档描述 Bomberman 项目的**生日主题**（礼物模式）：配置驱动的个人化、BGM/音效、资源与复用流程。它在不改变核心游戏逻辑的前提下扩展主设计（见 [TECHNICAL_DESIGN.zh-cn.md](TECHNICAL_DESIGN.zh-cn.md)）。与主设计的兼容通过**配置与主题扩展点**（见主设计第 2.3 节与第 5.3 节）保证。

---

## 1. 概述

### 1.1 目的
- 将游戏作为**生日礼物**送给朋友（普通朋友；可复用于不同朋友）。
- 保留核心 Bomberman 体验；增加**个人化**（名字、祝福、日期）和**生日主题**的视觉与音频。
- **复用**：一套代码，通过为不同朋友更换配置（及可选资源）得到定制构建或链接。

### 1.2 设计原则
- **配置驱动**：所有礼物相关内容（名字、祝福、BGM 选择、主题 id）来自配置，无需为每位朋友改代码。
- **可插拔**：生日主题通过主设计的配置与主题钩子（配置源、主题 id、BGM/皮肤路径）接入。
- **范围可控**：少量明确触点（屏幕上名字、一句祝福、生日 BGM、可选蜡烛/礼物）即可形成清晰的礼物感。

---

## 2. 配置（礼物配置）

### 2.1 礼物配置结构
主游戏应支持**礼物/主题配置**（见主设计：配置与主题兼容性）。生日主题下配置可包含：

| 字段 | 类型 | 说明 |
|------|------|------|
| `theme_id` | string | 如 `"default"` 或 `"birthday"`。决定加载哪套资源和 BGM 集。 |
| `friend_name` | string | 标题、胜利与落款中显示的名字。 |
| `birthday_date` | string | 可选；如 `"2025-03-15"` 用于展示。 |
| `message` | string | 短祝福或落款（一行）。 |
| `sender` | string | 可选；如你的名字，用于「来自 [sender]」。 |
| `bgm_track` | string | 主 BGM 的资源路径或 id（如生日歌）。 |
| `bgm_menu` | string | 可选；菜单 BGM（可与 `bgm_track` 相同或使用更安静版本）。 |
| `show_dedication` | bool | 是否显示落款行（如「致 [name]，来自 [sender]」）。 |

示例（JSON）：

```json
{
  "theme_id": "birthday",
  "friend_name": "小明",
  "birthday_date": "2025-03-15",
  "message": "祝你今天爆炸开心，蛋糕管够！",
  "sender": "我",
  "bgm_track": "res://audio/bgm/birthday_song.ogg",
  "bgm_menu": "res://audio/bgm/birthday_song_calm.ogg",
  "show_dedication": true
}
```

### 2.2 配置使用位置
- **主菜单 / 标题**：如「生日快乐，[friend_name]！」或「Bomberman for [friend_name]」。
- **胜利 / 游戏结束**：如「生日快乐，[friend_name]！你赢了！」及可选的短祝福。
- **落款行**：开场或结束处一行，如「致 [friend_name]，来自 [sender] – [birthday_date]。」由配置拼出；仅当 `show_dedication` 为 true 时显示。
- **主题 id**：用于加载生日主题资源（皮肤、瓦片、粒子）和 BGM 集（见下）。
- **BGM**：当主题为生日时，菜单与游戏内使用 `bgm_track`、`bgm_menu` 中的路径/id。

---

## 3. BGM 与音效

### 3.1 BGM 策略
- **默认主题**：使用常规 Bomberman 风格 BGM（如动作/街机）。
- **生日主题**：切换为生日风格 BGM；主设计应支持**按主题或配置选择 BGM**（见主设计第 5.3 节）。

### 3.2 生日 BGM 选项
- **主曲（游戏内）**  
  - **生日快乐（传统旋律）**：器乐或芯片音乐版本，易辨认且不依赖人声。  
  - **变体**：  
    - 欢快/派对版（节奏更快、打击感更强）。  
    - 安静/ lounge 版（较慢，用于菜单或胜利后）。  
  - **循环**：对曲目做无缝循环编辑，便于长时间游玩。

- **菜单 / 标题**  
  - 与主曲同旋律但**更安静**（如钢琴、柔和合成器）或更短循环。  
  - 配置：`bgm_menu` 可指向该版本。

- **胜利 / 首次胜利**  
  - **短 jingle**：5–10 秒的「生日快乐」高潮或由其衍生的 fanfare。  
  - 在玩家本局/本会话首次胜利时播放一次。  
  - 可选：jingle 结束后淡回菜单 BGM 或安静版生日曲。

### 3.3 BGM 实现注意
- **格式**：优先 OGG；控制文件大小以利于 Web 导出。
- **分层**：若可行，一个基础循环 + 可选层（如打击乐），使同一主题在菜单与游戏内略有差异。
- **音量**：配置或项目设置中的 BGM 音量，礼物版可设默认舒适值。
- **回退**：若 `bgm_track` 或 `bgm_menu` 缺失，回退到默认主题 BGM，保证游戏不崩溃。

### 3.4 音效（生日主题）
- **爆炸**：生日主题下可替换或混入**礼花/彩带**音效。
- **道具 / 收集**：轻量**派对**或**礼物**音效。
- **蜡烛收集**（若做蜡烛）：短**吹气**或**火花**音效。
- **胜利**：**掌声**或**短生日 jingle**（可与胜利 BGM jingle 共用）。
- 所有 SFX 按 `theme_id` 选择（如主题为生日时从 `res://audio/sfx/birthday/` 加载）。

---

## 4. 视觉与资源主题

### 4.1 生日主题资源
- **炸弹**：视觉上可选**生日蜡烛**或**礼物盒**（逻辑不变，仅精灵/动画不同）。
- **爆炸**：生日主题下使用**彩带/闪光**粒子（或与火焰混合）。
- **可破坏块**：可选**礼物盒**；被炸毁时掉落道具或显示短句（如配置中的「给你，[friend_name]！」）。
- **背景 / 瓦片**：可选生日配色或 subtle 图案（气球、蛋糕剪影）；保持网格可读。

### 4.2 名字与祝福展示位置
- **标题画面**：大号「生日快乐，[friend_name]！」或「Bomberman for [friend_name]」。
- **落款行**：标题底部或胜利后一行：「致 [friend_name]，来自 [sender] – [message] 或 [date]。」  
- **胜利画面**：「生日快乐，[friend_name]！你赢了！」及可选 `message`。  
- **可选**：游戏内 HUD 或稀有礼物块提示中显示 `message` 或名字。

---

## 5. 可选玩法触点

### 5.1 蜡烛收集
- **思路**：地图上少量**蜡烛**拾取物（类似可选收集）。集齐后显示「生日快乐，[friend_name]！」或解锁小奖励。
- **实现**：与其他收集物相同（计数、与总数比较）；仅主题与文案不同。

### 5.2 礼物块
- **思路**：部分可破坏块外观为**礼物盒**。被炸毁时掉落道具或显示配置中的一行（如 `message` 或「给你，[friend_name]！」）。
- **实现**：可破坏块类型 + 可选「销毁时显示消息」+ 主题精灵。

---

## 6. 复用流程（不同朋友）

### 6.1 单一代码库
- 一个项目；**每位朋友无需改代码**。  
- 个人化与主题选择全部通过**礼物配置**（及 theme id）完成。

### 6.2 分发方式
- **方式 A – 配置文件**：发布游戏 + 默认 `gift_config.json`。朋友（或你）修改 `friend_name`、`message`、`sender`、`birthday_date`；`theme_id` 设为 `"birthday"`，BGM 路径已指向生日资源。
- **方式 B – 构建/打包时**：为某位朋友构建时传入配置（如环境变量或文件路径）；构建脚本将配置嵌入项目或打包为默认。输出如 `BombermanFor_小明.zip` 或 `BombermanFor_小明.pck`。
- **方式 C – Web**：Web 导出时使用 `?name=小明&theme=birthday` 或 `?config=xiaoming.json`，实现一人一链接或一个构建从查询串/外部 JSON 加载配置。

### 6.3 每位朋友检查清单
- [ ] 在礼物配置中设置 `friend_name`、`message`、`sender`、`birthday_date`。
- [ ] 确认 `theme_id` 为 `"birthday"` 且 BGM 路径有效。
- [ ] （可选）为该朋友替换或增加自定义 BGM 文件。
- [ ] 用该配置构建或打包；测试标题、胜利与落款行。
- [ ] 分发构建或链接。

---

## 7. 与主设计的兼容性

- **配置**：主设计（第 5.3 节）约定**单一配置源**（如项目 config 或 Resource）及可选**主题/礼物配置路径**。生日主题用其承载第 2 节所有字段。
- **主题 id**：主设计支持 **theme id**（如 `default` 与 `birthday`），游戏据此加载对应 BGM 集、SFX 集与资源路径；生日主题将 `theme_id` 设为 `"birthday"`。
- **BGM**：主设计预留**按配置/主题选择 BGM**（菜单曲 vs 游戏曲、回退）。生日主题仅提供生日曲目并在礼物配置中引用。
- **UI 文案**：主设计应从**配置**（或由配置填充的 Resource）读取标题、胜利与落款文案，以便生日主题通过配置覆盖而无需改代码。

这样主设计保持主题无关，生日主题可作为纯「内容 + 配置」层叠加其上。
